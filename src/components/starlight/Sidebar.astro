---
import type { Props } from '@astrojs/starlight/props';

interface Link {
  type: 'link';
  label: string;
  href: string;
}

interface Group {
  type: 'group';
  label: string;
  entries: Link[];
}

type SidebarEntry = Link | Group;

const { sidebar } = Astro.props;
const currentPath = Astro.url.pathname;

const isCurrentPage = (path: string) => {
  return currentPath === path || currentPath === path + '/';
};
---

<div class="sl-sidebar">
  <div class="top-level">
    {
      sidebar.slice(0, 3).map((entry) => {
        if (entry.type !== 'link') return null;
        return (
          <a
            href={entry.href}
            class="nav-item top-level-item"
            aria-current={isCurrentPage(entry.href) ? 'page' : undefined}
          >
            {entry.label}
          </a>
        );
      })
    }
  </div>

  <div class="nav-sections">
    {
      sidebar.slice(3).map((entry, index) => {
        if (entry.type !== 'group') return null;
        return (
          <div class:list={['nav-section', { 'border-t border-gray-100 dark:border-gray-800 pt-4': index === 0 }]}>
            <div class="section-header">
              <span>{entry.label}</span>
            </div>
            <div class="nav-items">
              {entry.entries.map((item) => {
                if (item.type !== 'link') return null
                return (
                  <a
                    href={item.href}
                    class="nav-item"
                    aria-current={isCurrentPage(item.href) ? 'page' : undefined}
                  >
                    {item.label}
                  </a>
                )
              })}
            </div>
          </div>
        );
      })
    }
  </div>
</div>

<style>
  .sl-sidebar {
    @apply h-full py-4;
  }

  .top-level {
    @apply space-y-0.5 mb-4;
  }

  .nav-sections {
    @apply space-y-6;
  }

  .nav-section {
    @apply space-y-1;
  }

  .nav-item {
    @apply block py-2 px-4 text-[15px] text-[#56565C] hover:text-[#2D2D31] no-underline transition-colors;
  }

  .top-level-item {
    @apply text-[15px] font-normal;
  }

  .section-header {
    @apply px-4 py-2 text-xs font-medium text-[#2D2D31] uppercase tracking-wider;
  }

  .nav-items {
    @apply space-y-0.5;
  }

  /* Current page indicator */
  .nav-item[aria-current="page"] {
    @apply bg-[#F4F4F7] text-[#2D2D31] font-normal;
  }

  /* Dark mode overrides */
  :global(.dark) .nav-item {
    @apply text-gray-400 hover:text-white;
  }

  :global(.dark) .section-header {
    @apply text-gray-500;
  }

  :global(.dark) .nav-item[aria-current="page"] {
    @apply bg-gray-800 text-white;
  }
</style>